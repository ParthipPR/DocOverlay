name: Build Windows EXE

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Set up Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21'

    - name: Download JavaFX SDK
      shell: pwsh
      run: |
        Invoke-WebRequest -Uri https://download2.gluonhq.com/openjfx/21.0.1/openjfx-21.0.1_windows-x64_bin-sdk.zip -OutFile javafx.zip
        Expand-Archive -Path javafx.zip -DestinationPath .
        Rename-Item -Path "javafx-sdk-21.0.1" -NewName "javafx-sdk"

    - name: Set up Maven
      run: mvn clean package

    - name: Package using jpackage
      run: |
        jpackage `
          --type exe `
          --name DocOverlay `
          --input target `
          --main-jar docoverlay-1.0-SNAPSHOT.jar `
          --main-class com.example.App `
          --module-path javafx-sdk/lib `
          --add-modules javafx.controls,javafx.fxml,javafx.base,javafx.graphics,java.desktop `
          --dest output `
          --app-version 1.0

    - name: Upload .exe Artifact
      uses: actions/upload-artifact@v4
      with:
        name: DocOverlay-Installer
        path: output/**
